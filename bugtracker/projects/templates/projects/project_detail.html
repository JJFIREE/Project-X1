{% extends "projects/project_base.html" %}
{% block preproject %}

<div>
	<main class="content">
		<div class="container-fluid p-0">

			<h1 class="h3 mb-3">Project</h1>

			<div class="row">
				<div class="col-md-4 col-xl-3">
					<div class="card mb-3">
						<div class="card-header">
							<h5 class="card-title mb-0">Project Details</h5>
						</div>
						<div class="card-body text-center">
							<h1 style="font-size: 25px;" class="card-title mb-0">{{project.name.capitalize}}</h1>
							<div class="text-muted mb-2">{{project.description}}</div>

							<div>

								{% if project.complete == False %}
								{% if project.user == user %}
								<span class="badge badge-danger"><a
										href="{% url 'projects:complete' pk=project.pk %}">Mark
										Completed</a></span>
								<span class="badge badge-warning"><a href="{% url 'projects:delete' pk=project.pk %}">
										Delete</a></span>
								{% else %}
								<span class="badge badge-warning">Pending</span>
								{% endif %}
								{% else %}
								<span class="badge badge-success">Done</span>

								{% endif %}

								{% if project.complete == False and project.user != user %}

								{% if user in project.members.all %}
								<a href="{% url 'projects:leave' pk=project.pk %}"></span>Leave</a>
								{% else %}
								<a href="{% url 'projects:join' pk=project.pk  %}"></span>Join</a>
								{% endif %}

								{% else %}

								{% if user in project.members.all and user != project.user %}
								<td><a href="{% url 'projects:leave' pk=project.pk %}"></span>leave</a></td>
								{% endif %}
								{% endif %}



							</div>
						</div>
						<hr class="my-0" />
						<div class="card-body">
							<h5 class="h6 card-title">Tags</h5>
							{% for tag in project.tags.all %}
							<a href="#" class="badge badge-primary mr-1 my-1">{{tag}}</a>
							{% endfor %}

						</div>
						<hr class="my-0" />
						<div class="card-body">
							<h5 class="h6 card-title">About</h5>
							<ul class="list-unstyled mb-0">
								<li class="mb-1"><span data-feather="file-plus" class="feather-sm mr-1"></span> Created
									At
									<a href="#"> {{project.created_at}}</a></li>

								<li class="mb-1"><span data-feather="users" class="feather-sm mr-1"></span> Project
									Members <a href="#"> {{project.members.count}}</a></li>
								<li class="mb-1"><span data-feather="alert-triangle" class="feather-sm mr-1"></span>
									Total issues <a href="#"> {{project.issues.count}}</a></li>
								<li class="mb-1"><span data-feather="user" class="feather-sm mr-1"></span> Created By
									<a href="#"> {{project.user.username}}</a></li>
							</ul>
						</div>
						<hr class="my-0" />
					</div>
				</div>
				{% endblock %}

				{% block project_content %}

				<div class="col-md-8 col-xl-9">
					<div class="card">
						<div class="card-header">

							<h5 class="card-title mb-0">Issues</h5>
						</div>
						<table class="table table-hover my-0">
							<thead>
								<tr>
									<th>Name</th>
									<th class="d-none d-xl-table-cell">Created At</th>
									<th class="d-none d-xl-table-cell">Created By</th>
									<th class="d-none d-xl-table-cell">Project</th>
									<th class="d-none d-xl-table-cell">Members Working</th>
									<th>Status</th>
									<th>Actions</th>
								</tr>
							</thead>
							<tbody>
								{% if user in project.members.all %}
								{% if project.issues.count == 0 %}
								<div class="card-header">
									<h5 class="card-title mb-0">No issues in this project yet!</h5>
								</div>
								{% else %}
								{% for issue in project.issues.all %}
								{% include "issues/_issue.html" %}
								{% endfor %}
								{% endif %}
								{% else %}
								<div class="card-header">
									<h2 style="font-size: 25px;" class="card-title mb-0">You are not a member of this project, Join to view the Issues</h2>
								</div>

								{% endif %}
							</tbody>
						</table>

					</div>
				</div>
			</div>
		</div>
	</main>
</div>
{% endblock %}


