{% extends "projects/project_base.html" %}
{% block project_content %}

<div>
	<main class="content">
		<div class="container-fluid p-0">

			<h1 class="h3 mb-3">Project</h1>

			<div class="row">
				<div class="col-md-4 col-xl-3">
					<div class="card mb-3">
						<div class="card-header">
							<h5 class="card-title mb-0">Project Details</h5>
						</div>
						<div class="card-body text-center">
							<h1 style="font-size: 25px;" class="card-title mb-0">{{project.name.capitalize}}</h1>
							<div class="text-muted mb-2">{{project.user.username}}</div>

							<div>

								{% if project.complete == False %}
								{% if project.user == user %}
								<span class="badge badge-danger"><a
										href="{% url 'projects:complete' pk=project.pk %}">Mark
										Completed</a></span>
								<span class="badge badge-warning"><a href="{% url 'projects:delete' pk=project.pk %}">
										Delete</a></span>
								{% else %}
								<span class="badge badge-warning">Pending</span>
								{% endif %}
								{% else %}
								<span class="badge badge-success">Done</span>

								{% endif %}

								{% if project.complete == False and project.user != user %}

								{% if user in project.members.all %}
								<a href="{% url 'projects:leave' pk=project.pk %}"></span>Leave</a>
								{% else %}
								<a href="{% url 'projects:join' pk=project.pk  %}"></span>Join</a>
								{% endif %}

								{% else %}

								{% if user in project.members.all and user != project.user %}
								<td><a href="{% url 'projects:leave' pk=project.pk %}"></span>leave</a></td>
								{% endif %}
								{% endif %}

								{% if user in project.members.all or user == project.user %}
								<br><br>
								<a class="btn btn-primary btn-sm" href="{% url 'chats:project' pk=project.pk %}"><span
										data-feather="message-square"></span>Discuss</a>
								{% endif %}



							</div>
						</div>
						<hr class="my-0" />
						<div class="card-body">
							<h5 class="h6 card-title">Tags</h5>
							{% for tag in project.tags.all %}
							<a href="{% url 'projects:tagged' pk=tag.pk %}"
								class="badge badge-primary mr-1 my-1">{{tag|safe}}</a>
							{% endfor %}

						</div>
						<hr class="my-0" />
						<div class="card-body">
							<h5 class="h6 card-title">About</h5>
							<ul class="list-unstyled mb-0">
								<li class="mb-1"><span data-feather="file-plus" class="feather-sm mr-1"></span> Created
									At
									<strong> {{project.created_at}}</strong></li>
								<li class="mb-1"><span data-feather="user" class="feather-sm mr-1"></span> Created By <a
										href="{% url 'accounts:profile' pk=project.user.pk %}">
										{{project.user.username}}</a></li>

								<li class="mb-1"><span data-feather="users" class="feather-sm mr-1"></span> Project
									Members <strong> {{project.members.count}}</strong></li>
								<li class="mb-1"><span data-feather="alert-triangle" class="feather-sm mr-1"></span>
									Total issues <strong> {{project.issues.count}}</strong></li>
							</ul>
						</div>
						<hr class="my-0" />
					</div>
				</div>


				<div class="col-md-8 col-xl-9">
					<div class="card">
						<div class="card-header">
							<h5 class="card-title mb-0">Description</h5>
						</div>

						<div class="card-body h-100">
							<hr />
							<div>
								{{project.description|safe}}
							</div>
							<hr />
							{% if user in project.members.all or project.user == user %}
							{% if not project.issues.all %}
							<div>
								<h3>No Issues yet</h3>
							</div>
							<hr />
							{% else %}

							<table class="table table-hover my-0">
								<thead>
									<tr>
										<th>Name</th>
										<th class="d-none d-xl-table-cell">Created At</th>
										<th class="d-none d-xl-table-cell">Created By</th>
										<th class="d-none d-xl-table-cell">Project</th>
										<th class="d-none d-xl-table-cell">Members Working</th>
										<th>Status</th>
										<th>Actions</th>
									</tr>
								</thead>
								<tbody>
									{% for issue in project.issues.all %}
									{% include "issues/_issue.html" %}
									{% endfor %}

								</tbody>
							</table>
							{% endif %}
						</div>
					</div>
				</div>


				{% else %}
				<div class="card-header">
					<h2 style="font-size: 25px;" class="card-title mb-0">You are not a member of this
						project, Join to view the Issues</h2>
				</div>

				{% endif %}
			</div>
		</div>
	</main>
</div>
{% endblock %}